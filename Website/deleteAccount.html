<!DOCTYPE html>
<html>
  <head>
    <title>Delete Account</title>
    <link rel="stylesheet" type="text/css" href="css/style.css">
        <style>
    </style>
  </head>
  <body>
    <div class="header">
      <div class="logo">
        <h1> B.C Health & Wellness</h1>
      </div>
    </div>

    <div class="nav">
      <a href="homePage.html">HOME</a>
      <a onclick="redirect()">ACCOUNT</a>
    </div>

    <div class="Staff-Page-tile">
      <h1>Delete Account</h1>
      <form id="delete-account-form">
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required>

        <label for="password">Password:</label>
        <input type="password" id="password" name="password" required>

        <label for="emailToDelete">Email to delete:</label>
        <input type="email" id="emailToDelete" name="emailToDelete" required>

        <button type="submit">Delete Account</button>
      </form>
      <p id="delete-message"></p>
    </div>

    <script>
     //web crypto api
            function sha512(str) {
                return crypto.subtle.digest("SHA-512", new TextEncoder("utf-8").encode(str)).then(buf => {
                    return Array.prototype.map.call(new Uint8Array(buf), x=>(('00'+x.toString(16)).slice(-2))).join('');
                });
            }
    
      const form = document.getElementById("delete-account-form");
      const message = document.getElementById("delete-message");

      form.addEventListener("submit", (event) => {
        event.preventDefault();
        const email = form.email.value;
        const password = form.password.value;
        var hashedPassword = await sha512(password)
        const emailToDelete = form.emailToDelete.value;

        fetch(`http://localhost:8080/deleteAccount?email=${email}&password=${hashedPassword}&emailToDelete=${emailToDelete}`)
          .then(response => {
            if (response.ok) {
              message.innerText = "Account has been deleted";
            } else {
              message.innerText = "Failed to delete account";
            }
          })
          .catch(error => {
            message.innerText = "Error deleting account";
            console.error("Error:", error);
          });
      });
      function redirect(){
          let accountType = sessionStorage.getItem("accountType");

          if (accountType == "p"){
            window.location.assign("accountDetailsPatient.html");
          } else if (accountType == "s") {
            window.location.assign("accountDetailsStaff.html");
          } else if (accountType == "d"){
            window.location.assign("accountDetailsDoctor.html");
          }
          else {
            alert("Not logged in!")
          }
        }
    </script>
  </body>
</html>
