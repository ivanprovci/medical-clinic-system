<!DOCTYPE html>
<html>
  <head>
    <title>Approve Patient</title>
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <style>
        #statusLoading{
            display:none;
        }
        #statusComplete{
            display:none;
        }
    </style>
  </head>
  <body>
    <div class="header">
      <div class="logo">
        <h1> B.C Health & Wellness</h1>
      </div>
    </div>

    <div class="nav">
      <a href="homePage.html">HOME</a>
      <a onclick="redirect()">ACCOUNT</a>
    </div>

    <div class="Staff-Page-tile" style="top:30%; height:30%;">
      <h1>Approve Patient</h1>
      <form id="delete-account-form" style="width:initial">

        <label for="emailToApprove">Account to approve: (Enter email)</label>
        <input type="email" id="emailToApprove" name="emailToApprove" required> <br> 

        <button type="button" onclick="approvePatient();showLoading()">Approve Patient</button>
      </form>
      <span id="statusLoading"><img src="images/loading.gif" alt="" heigh="20px" width="20px"></span>
      <span id="statusComplete"><p>User verified!</p></span>
    </div>

    <script>
        function showLoading(){
            document.getElementById("statusLoading").style.display = "inline";
        }

      async function approvePatient(){
        let staffEmail = sessionStorage.getItem("email")
        let staffPassword = sessionStorage.getItem("password")
        let approveEmail = document.getElementById("emailToApprove").value

        let verifyURL = `http://localhost:8080/verifyPatient?staffEmail=${staffEmail}&staffPassword=${staffPassword}&patientEmail=${approveEmail}`
            fetch(verifyURL, {
              method: "POST",
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({
                staffEmail: staffEmail,
                staffPassword: staffPassword,
                patientEmail: approveEmail
              })
            })
            .then(response => {
              if (response.ok) {
                document.getElementById("statusLoading").style.display = "none";
                document.getElementById("statusComplete").style.display = "inline";
                console.log('Verification successful')
              } else {
                console.log('Verification error')
              }
            })
            .catch(error => {
              console.error('Error:', error)
            })
      }
      

      
      function redirect(){
          let accountType = sessionStorage.getItem("accountType");

          if (accountType == "p"){
            window.location.assign("accountDetailsPatient.html");
          } else if (accountType == "s") {
            window.location.assign("accountDetailsStaff.html");
          } else if (accountType == "d"){
            window.location.assign("accountDetailsDoctor.html");
          }
          else {
            alert("Not logged in!")
          }
        }
    </script>
  </body>
</html>
