<!DOCTYPE html>
<html>
    <head>
        <title>Staff Account</title>
        <link rel="stylesheet" type="text/css" href="css/style.css">
    </head>
    <style>

.Staff-Page-tile {

    overflow-y: scroll; 
}


    </style>
    <body>
        <div class="header">
            <div class="logo">
                <h1>B.C Health & Wellness</h1>
            </div>
        </div>
        
        <div class="nav">
            <a href="homePage.html">HOME</a>
            <a onclick="redirect()">ACCOUNT</a>
        </div>

        <!-- Using the Same format that was used in the Staff Account Details page for this one -->
        <div class="Staff-Page-tile">
            <h1>View records</h1>
            <ul id="recordList">
            </ul>
        </div>
        <script>
            function redirect(){
                let accountType = sessionStorage.getItem("accountType");
            
                if (accountType == "p"){
                    window.location.assign("accountDetailsPatient.html");
                } else if (accountType == "s") {
                    window.location.assign("accountDetailsStaff.html");
                } else if (accountType == "d"){
                    window.location.assign("accountDetailsDoctor.html");
                }
                else {
                    alert("Not logged in!")
                }
            }
          
            // Fetch records from the server
            fetch('http://localhost:8080/getRecords?email=' + sessionStorage.getItem("email") + '&password=' + sessionStorage.getItem("password") + '&recordType=all') 
                .then(response => response.json())
                .then(records => {
                    const recordList = document.getElementById('recordList');
          
                    // Create list item for each record
                    records.forEach(record => {
                        const listItem = document.createElement('li');
                        listItem.innerHTML = `<b>Record ID:</b> ${record.recordID}<br>
                                               <b>Related Patient:</b> ${record.relatedPatient}<br>
                                               <b>Exam Date:</b> ${record.examDate}<br>
                                               <b>prescribedDuring:</b> ${record.prescribedDuring}<br>
                                               <b>patientHealthNo:</b> ${record.patientHealthNo}<br>
                                               <b>Prescribing Doctor:</b> ${record.prescribingDoctor}<br>`
                                               
                                               
                        
                        // Check if the record is a Prescription Record or a Visit Record
                        if (record.datePrescribed) {
                            // Prescription record
                            //// Add prescription details to list item
                            listItem.innerHTML +=`<b>Date Prescribed:</b> ${record.datePrescribed}<br>
                                                   <b>Medicine Name:</b> ${record.medicineName ? record.medicineName: 'N/A'}<br>
                                                   <b>Medicine Quantity:</b> ${record.medicineQuantity ? record.medicineQuantity : 'N/A'}<br>
                                                   <b>Medicine Dose:</b> ${record.medicineDose ? record.medicineDose + ' ' + record.medicineDoseUnit : 'N/A'}<br>
                                                   <b>Refillable:</b> ${record.refillable}<br>`;
                        }
                        if (record.visitDate) {
                            // VisitRecord
                            // Add Vist details to the list item
                            listItem.innerHTML +=`<b>Visit Date:</b> ${record.visitDate ? record.visitDate: 'N/A'}<br>
                                                <b>Prescribed Medications:</b> ${record.prescribedMedications && record.prescribedMedications.length > 0 ? record.prescribedMedications.join(', ') : 'N/A'}<br>
                                                 <b>Prescribed Lab Exam:</b> ${record.prescribedLabExams && record.prescribedLabExams.length > 0 ? record.prescribedLabExams.join(', ') : 'N/A'}<br>`;
                        
                        } else {
                        // LabResult record
                        // Look up the lab exam by its ID

                        // Add LabResult details to the list item
                         listItem.innerHTML +=`<b>Lab Exam:</b> ${record.examItem ? record.examItem : 'N/A'}<br>
                                            <b>Result:</b> ${record.result ? record.result : 'N/A'}<br>
                                            <b>Normal Range:</b> ${record.normalLowerBound && record.normalUpperBound ? `${record.normalLowerBound}-${record.normalUpperBound}` : 'N/A'}<br>
                                            <b>Normal Result:</b> ${record.normalResult ? 'Yes' : 'No'}`;
                    }
                        

                          // Add a line between each record.
                          listItem.innerHTML += '<b><hr></b>';
          
                    
          
                        recordList.appendChild(listItem);
                    });
                })
                .catch(error => console.error(error));
          </script>
          
    </body>
</html>