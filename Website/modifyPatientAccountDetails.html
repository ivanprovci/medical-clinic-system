<!DOCTYPE html>
<html>
  <head>
    <title>Modify Patient Account</title>
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <style>
      #updateSent{
        display: none
      }
    </style>
    <script>
      //web crypto api
      function sha512(str) {
        return crypto.subtle.digest("SHA-512", new TextEncoder("utf-8").encode(str)).then(buf => {
            return Array.prototype.map.call(new Uint8Array(buf), x=>(('00'+x.toString(16)).slice(-2))).join('');
        });
      }

      function redirect(){
        let accountType = sessionStorage.getItem("accountType");

        if (accountType == "p"){
          window.location.assign("accountDetailsPatient.html");
        } else if (accountType == "s") {
          window.location.assign("accountDetailsStaff.html");
        } else if (accountType == "d"){
          window.location.assign("accountDetailsDoctor.html");
        }
        else {
          alert("Not logged in!")
        }
      }

      async function updateAccountInfo(){
        //get all form inputs
        var email = document.getElementById("email").value
        var password = await sha512(document.getElementById("password").value)
        var fName = document.getElementById("fname").value
        var lName = document.getElementById("lname").value
        var phoneNo = document.getElementById("phone").value
        var address = document.getElementById("address").value
        var healthNo = document.getElementById("healthcard").value

        let url = `http://localhost:8080/updatePatient?email=${email}&password=${password}&firstName=${fName}&lastName=${lName}&phoneNo=${phoneNo}&address=${address}&healthNo=${healthNo}`
        fetch(url, {
          method: "POST",
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            email: email,
            password: password,
            firstName: fname,
            lastName: lName,
            phoneNo: phoneNo,
            address: address,
            healthNo: healthNo
          })
        })
        .then(response => {
          if (response.ok) {
            console.log('Data sent successfully')
          } else {
            console.log('Error sending data')
          }
        })
        .catch(error => {
          console.error('Error:', error)
        })

        document.getElementById("updateSent").style.display = "inline"
        document.querySelector("form").reset()
      }
    </script>
  </head>
  <body>
    <div class="header">
      <div class="logo">
        <h1> B.C Health & Wellness</h1>
      </div>
    </div>

    <div class="nav">
      <a href="homePage.html">HOME</a>
      <a onclick="redirect()">ACCOUNT</a>
    </div>
    <!-- Using the Same format that was used in the Staff Account Details page fo this one -->
    <div class="Staff-Page-tile" style="top:40%">
      <h1>Modify Account Details</h1>
      <p>Enter a patients's email and password(required) and enter an input for the fields you want to change. Leave blank to keep field the same.</p><br><br>
        <form class="Input-form" style="margin-left:15px;display:inline;width:initial">
          <label for="email">Patient Email:</label>
          <input type="text" id="email" name="email" required><br>

          <label for="password">Patient Password:</label>
          <input type="password" id="password" name="password" style="border: none;margin-top: 10px;padding: 4px;border-bottom: solid black 1px;" required><br>

          <label for="fname">Patient First Name:</label>
          <input type="text" id="fname" name="fname" ><br>

          <label for="lname">Patient Last Name:</label>
          <input type="text" id="lname" name="lname" ><br>

          <label for="phone">Patient Phone Number:</label>
          <input type="text" id="phone" name="phone" ><br>

          <label for="address">Patient Address:</label>
          <input type="text" id="address" name="address" required><br>

          <label for="healthcard">Health Card Number:</label>
          <input type="text" id="healthcard" name="healthcard" required><br><br>

          <input type="button" onclick="updateAccountInfo()" value="Update"> <br><br>
        </form>
        <span id="updateSent"><p>Account info updated!</p></span>
    </div>
  </body>
</html>